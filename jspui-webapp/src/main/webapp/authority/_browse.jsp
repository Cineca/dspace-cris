<%--
  - _browse.jsp
  -
  - Version: $Revision: 1693 $
  --%>
<%@ page contentType="text/html;charset=UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt"%>
<%@ taglib uri="http://www.springframework.org/tags/form" prefix="form"%><%@ taglib uri="http://www.springframework.org/tags" prefix="spring"%>
<%@ taglib uri="http://displaytag.sf.net" prefix="display"%><%@ page import="java.net.URLEncoder" %><%@ page import="org.dspace.core.Utils" %><%@ page import="org.dspace.app.webui.util.UIUtil" %>
<%@ page import="java.util.List" %><%@ page import="it.cilea.hku.authority.browse.*" %>
<div id="content">
<h1><fmt:message key="jsp.layout.hku.browse.${suffix}"/></h1><c:choose><c:when test="${empty mode}">
	<ul>	<c:forEach items="${results}" var="result">	<li>				<c:url var="browseurl" value="${contextPath}/rp/browse.htm">		<c:param name="sort_by" value="${sort_by}" />		<c:param name="mode" value="${type}" />		<c:param name="type" value="${type}" />		<c:param name="query" value="${result.name}" />		<c:param name="filter" value="${facet}" />		<c:param name="field" value="${field}" />		</c:url>		<a href="${browseurl}">${result.name} (${result.count})</a>					</li>					</c:forEach>	</ul>				</c:when><c:otherwise>			<%    	//First, get the browse info object	BrowseResearcherInfo bi = (BrowseResearcherInfo) request.getAttribute("results");	Object mode = request.getAttribute("mode");	String query = (String) request.getParameter("query");	String filter = (String) request.getParameter("filter");		// prepare the next and previous links	String linkBase = request.getContextPath() + "/rp/";			String sort_by = bi.getSortBy();	String field = bi.getField();	String order = bi.isAscending()?"ASC":"DESC";	String sharedLink = linkBase + "browse.htm?"+ 						"mode=" + mode +								"&amp;order=" + order +						"&amp;sort_by=" + sort_by +						"&amp;field=" + field +						"&amp;rpp=" + URLEncoder.encode(Integer.toString(bi.getResultsPerPage())) +						"&amp;filter=" + URLEncoder.encode(filter) +						"&amp;query=" + URLEncoder.encode(query);	String sortLink = linkBase + "browse.htm?"+ 						"mode=" + mode +						"&amp;order=" + (order.equalsIgnoreCase("asc")? "desc" : "asc") +						"&amp;sort_by=" + sort_by +						"&amp;field=" + field +						"&amp;rpp=" + URLEncoder.encode(Integer.toString(bi.getResultsPerPage())) +						"&amp;filter=" + URLEncoder.encode(filter) +						"&amp;query=" + URLEncoder.encode(query);	// prepare the next and previous links	String next = sharedLink;	String prev = sharedLink;		if (bi.hasNextPage())    {        next = next + "&amp;offset=" + bi.getNextOffset();    }	if (bi.hasPrevPage())    {        prev = prev + "&amp;offset=" + bi.getPrevOffset();    }	// prepare a url for use by form actions	String formaction = request.getContextPath() + "/rp/";		formaction = formaction + "browse.htm";	int rpp = bi.getResultsPerPage();%><table width="98%" align="left" border="0" cellpadding="0" summary="Browsing"><!-- ## A-Z navigation starts --><tr><td>	<%-- Include the main navigation for all the browse pages --%>	<%-- This first part is where we render the standard bits required by both possibly navigations --%>	<div align="left" id="browse_navigation">	<form method="get" action="<%= formaction %>">									<input type="hidden" name="rpp" value="<%= rpp %>"/>			<input type="hidden" name="order" value="<%= order %>"/>							<div id="search">				<fieldset>					<legend>Browse</legend>					<label>						<span class="browseBarLabel"><fmt:message key="browse.nav.jump"/></span>						<a href="<%= sharedLink %>">0-9</a><%	    for (char c = 'A'; c <= 'Z'; c++)	    {%>	                        <a href="<%= sharedLink %>&amp;starts_with=<%= c %>"><%= c %></a><%	    }		String chi = "\u4e2d";%>		<a href="<%= sharedLink %>&amp;starts_with=zz"><%= chi %></a>		<a href="<%= sharedLink %>&amp;offset=999999">&gt;&gt;</a>					</label>					<div class="leftpad">						or enter initial letters to jump into index at that point: 						<input type="text" name="starts_with"/>&nbsp;											</div>					<div class="rightpad">						<input type="hidden" value="${mode}" name="mode"/>						<input type="hidden" value="<%= field%>" name="field"/>						<input type="hidden" value="<%= sort_by%>" name="sort_by"/>						<input type="submit" value="<fmt:message key="browse.nav.go"/>" />					</div>				</fieldset>			</div>	</form>	</div>	<%-- End of Navigation Headers --%></td></tr><!-- ## A-Z navigation ends --><!-- ## top report starts --><tr><td class="menuBar">	<%-- give us the top report on what we are looking at --%>	<div align="center" class="browse_range">		<b>		<fmt:message key="browse.single.range">			<fmt:param value="<%= Integer.toString(bi.getStart()) %>"/>			<fmt:param value="<%= Integer.toString(bi.getFinish()) %>"/>			<fmt:param value="<%= Integer.toString(bi.getTotal()) %>"/>		</fmt:message>		</b>	</div></td></tr><!-- ## top report ends --><!-- ## previous and next page links starts --><tr><td>	<%--  do the top previous and next page links --%>	<div align="center"><% 	if (bi.hasPrevPage())	{%>	<a href="<%= prev %>"><fmt:message key="browse.single.prev"/></a>&nbsp;<%	}%><%	if (bi.hasNextPage())	{%>	&nbsp;<a href="<%= next %>"><fmt:message key="browse.single.next"/></a><%	}%>	</div></td></tr><!-- ## previous and next page links ends --><!-- ## result list starts --><tr><td>	<%-- THE RESULTS --%>			<div>						 <table class="miscTable" summary="browse results table">            <tr>            	<th></th>	                  <th id="t1" class="oddRowEvenCol <%= order.equalsIgnoreCase("ASC")?"sorted_asc":"sorted_desc" %>"><a href="<%=sortLink%>"><strong><fmt:message key="jsp.layout.table.hku.browse${mode}.firstmetadata"/></strong></a></th>                <th id="t2" class="oddRowOddCol"><strong><fmt:message key="jsp.layout.table.hku.browse${mode}.secondmetadata"/></strong></th>		        <th id="t3" class="oddRowEvenCol"><strong><fmt:message key="jsp.layout.table.hku.browse${mode}.thirdmetadata"/></strong></th>            </tr><%        String row = "even";        for (BrowseResearcher objectList : bi.getResults())        {        	BrowseResearcher object = ((BrowseResearcher)objectList);        	boolean authority = object.getAuthorityMetadata()[1].isEmpty()?false:true;%>		   <tr>		   <% if (object.getIcon()!=null)  { %>		   		<td headers="t0" class="<%= row %>RowEvenCol">		    							<%=object.getIcon()%>					                	                </td>           <% } %>     		    	<td headers="t1" class="<%= row %>RowEvenCol">		    				    		<ul class="topmenu" id="css3menu1">		    									<li class="topmenu"><a href="<%= object.getDetailsPath() %>"><%= object.getFirstMetadata() %></a>																			<ul>							<li><%=  object.getTooltipText() %></li>												</ul>						</li>					</ul>					                	                </td>                <td headers="t2" class="<%= row %>RowEvenCol">                <% if(authority) { %>						<a href="<%= object.getAuthorityMetadata()[1] %>"> <em><%= object.getAuthorityMetadata()[0] %></em> <%= object.getAuthorityMetadata()[2] %> <%= object.getAuthorityMetadata()[3] %> </a>				<% } else {%>						<em><%= object.getAuthorityMetadata()[0] %></em> <%= object.getAuthorityMetadata()[3] %>				<% } %>                                    </td>                <td headers="t3" class="<%= row %>RowOddCol">                    	<%= object.getThirdMetadata() %>                 </td>  			</tr>		<% 			 row = (row.equals("odd") ? "even" : "odd");        }%>        </table>			</div></td></tr><!-- ## result list ends -->	<%-- dump the results for debug (uncomment to enable) --%>	<%-- 	<!-- <%= bi.toString() %> -->    --%><!-- ## previous and next page links starts --><tr><td>	<%--  do the top previous and next page links --%>	<div align="center"><% 	if (bi.hasPrevPage())	{%>	<a href="<%= prev %>"><fmt:message key="browse.single.prev"/></a>&nbsp;<%	}%><%	if (bi.hasNextPage())	{%>	&nbsp;<a href="<%= next %>"><fmt:message key="browse.single.next"/></a><%	}%>	</div></td></tr><!-- ## previous and next page links ends --></table>	</c:otherwise></c:choose></div>