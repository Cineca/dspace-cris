<?xml version="1.0"?>
<!--

    <!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 2.0//EN">
    <html><head>
    <title>301 Moved Permanently</title>
    </head><body>
    <h1>Moved Permanently</h1>
    <p>The document has moved <a href="https://svn.duraspace.org/dspace/licenses/LICENSE_HEADER">here</a>.</p>
    </body></html>

-->

<project name="researcherpage" basedir="${basedir}">
        <property name="hibernate_properties" value="/data/apphome/dspace/config/hibernate-rp.properties" />
        <property name="hibernate_configuration" value="/data/apphome/dspace/config/hibernate-rp.cfg.xml" />
        <property name="log4j_properties" value="/data/apphome/dspace/config/log4j.properties" />
        <property file="${hibernate_properties}" />
        <property file="${log4j_properties}" />

        <dirname file="${log4j.appender.A1.File}" property="loggingDir" />

        <!-- Generate the schema for all mapping files in our class tree -->
        <target name="generate-ddl" description="Generate DDL from the O/R mapping files">                
                <taskdef name="hibernatetool" classname="org.hibernate.tool.ant.HibernateToolTask" />
                <hibernatetool destdir="${basedir}">
                        <classpath refid="maven.compile.classpath" />
                        <annotationconfiguration configurationfile="${hibernate_configuration}" />
                        <hbm2ddl export="false" console="true" drop="false" create="true" outputfilename="schema.ddl" delimiter=";" />
                </hibernatetool>
        </target>

        <!-- Generate the schema for UPDATE all mapping files in our class tree -->
        <target name="generate-update-ddl" description="Generate UPDATE DDL from the O/R mapping files">        	
                <taskdef name="hibernatetool" classname="org.hibernate.tool.ant.HibernateToolTask" />
                <hibernatetool destdir="${basedir}">
                        <classpath refid="maven.compile.classpath" />
                        <annotationconfiguration configurationfile="${hibernate_configuration}" />
                        <hbm2ddl export="false" console="true" drop="false" create="false" update="false" outputfilename="schema-update.ddl" delimiter=";" haltonerror="false"/>                    
                </hibernatetool>
        </target>
	

        <target name="generate-drop-ddl" description="Generate DDL from the O/R mapping files">
                <taskdef name="hibernatetool" classname="org.hibernate.tool.ant.HibernateToolTask" />
                <hibernatetool destdir="${basedir}">
                        <classpath refid="maven.compile.classpath" />
                        <annotationconfiguration configurationfile="${hibernate_configuration}" />
                        <hbm2ddl export="false" console="true" drop="true" create="false" outputfilename="schema-drop.ddl" delimiter=";" />                                             
                </hibernatetool>        
        </target>

        <target name="create-tables-and-GEN-DDL" depends="generate-ddl, generate-drop-ddl" description="Generate tables from the DDL file">
                <sql driver="${hibernate.connection.driver_class}" url="${hibernate.connection.url}" userid="${hibernate.connection.username}" password="${hibernate.connection.password}" onerror="continue" src="schema.ddl">
                        <classpath refid="maven.compile.classpath" />
                </sql>
        </target>

        <target name="create-tables-NO-GEN-DDL" description="Generate tables from the DDL file (NO REGEN)">
                <sql driver="${hibernate.connection.driver_class}" url="${hibernate.connection.url}" userid="${hibernate.connection.username}" password="${hibernate.connection.password}" onerror="continue" src="schema.ddl">
                        <classpath refid="maven.compile.classpath" />
                </sql>
        </target>

        <target name="refresh-database" depends="drop-table, create-tables-and-GEN-DDL" description="Ricrea il Database da zero" />

        <target name="drop-table" description="DROP table">
                <sql driver="${hibernate.connection.driver_class}" url="${hibernate.connection.url}" userid="${hibernate.connection.username}" password="${hibernate.connection.password}" onerror="continue" src="schema-drop.ddl">
                        <classpath refid="maven.compile.classpath" />
                </sql>
        </target>

        <target name="populate-tables" description="Populate tables">
                <sql driver="${hibernate.connection.driver_class}" url="${hibernate.connection.url}" userid="${hibernate.connection.username}" password="${hibernate.connection.password}" onerror="continue" src="config_anagrafica.sql">
                        <classpath refid="maven.compile.classpath" />
                </sql>
        </target>
</project>